using System;
using System.IO;

namespace Microsoft.Exchange.Transport.Agent.Malware.SoftDelete
{
	internal class Obfuscate
	{
		public static byte[] Encode(Stream message)
		{
			if (message == null)
			{
				throw new ArgumentException("message stream cannot be set to null");
			}
			byte[] messageAsByteArray = Obfuscate.GetMessageAsByteArray(message);
			byte[] array = new byte[messageAsByteArray.Length];
			for (int i = 0; i < messageAsByteArray.Length; i++)
			{
				byte[] array2 = array;
				int num = i;
				byte[] array3 = messageAsByteArray;
				int num2 = i;
				array2[num] = (array3[num2] ^= Obfuscate.obfuscateValue);
			}
			return array;
		}

		public static byte[] Decode(byte[] buffer)
		{
			if (buffer == null)
			{
				throw new ArgumentException("Buffer cannot be set to null.");
			}
			byte[] array = new byte[buffer.Length];
			for (int i = 0; i < buffer.Length; i++)
			{
				byte[] array2 = array;
				int num = i;
				int num2 = i;
				array2[num] = (buffer[num2] ^= Obfuscate.obfuscateValue);
			}
			return array;
		}

		private static byte[] GetMessageAsByteArray(Stream stream)
		{
			byte[] array = null;
			if (stream == null)
			{
				throw new ArgumentNullException("Stream cannot be set to null");
			}
			array = new byte[stream.Length];
			try
			{
				stream.Seek(0L, SeekOrigin.Begin);
				stream.Read(array, 0, (int)stream.Length);
				stream.Seek(0L, SeekOrigin.Begin);
			}
			catch (Exception)
			{
				throw;
			}
			return array;
		}

		private static byte obfuscateValue = byte.MaxValue;
	}
}
