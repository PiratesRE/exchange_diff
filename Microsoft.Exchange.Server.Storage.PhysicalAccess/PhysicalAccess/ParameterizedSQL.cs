using System;

namespace Microsoft.Exchange.Server.Storage.PhysicalAccess
{
	internal class ParameterizedSQL
	{
		public static string[] CreateDatabase = new string[]
		{
			"USE master ",
			"CREATE DATABASE [{0}] ON PRIMARY (NAME = N'{0}', FILENAME = N'{1}' , SIZE = 100MB, FILEGROWTH = 500MB) LOG ON (NAME = N'{0}Log', FILENAME = N'{2}' , SIZE = 100MB, FILEGROWTH = 500MB) COLLATE SQL_Latin1_General_CP1_CI_AS ",
			"ALTER DATABASE [{0}] SET AUTO_UPDATE_STATISTICS_ASYNC ON ",
			"ALTER DATABASE [{0}] SET RECOVERY FULL ",
			"ALTER DATABASE [{0}] ADD FILEGROUP [fg1] ",
			"ALTER DATABASE [{0}] ADD FILE (NAME = N'{0}datafile1', FILENAME = N'{3}1' , SIZE = 100MB, FILEGROWTH = 500MB) TO FILEGROUP [fg1] ",
			"ALTER DATABASE [{0}] MODIFY FILEGROUP [fg1] DEFAULT ",
			"USE [{0}] ",
			"CREATE SCHEMA [Exchange] ",
			"CREATE FUNCTION [Exchange].[IsNotZero](@number BIGINT) RETURNS BIT AS BEGIN IF (@number > 0) RETURN 1 RETURN 0 END ",
			"sp_dbcmptlevel [{0}],100 ",
			"sp_configure 'clr enabled', 1 ",
			"reconfigure with override ",
			"DECLARE @exchangeTableCount INT DECLARE @allowUnsafeAssemblies BIT SET @allowUnsafeAssemblies = 0 SET @exchangeTableCount = (SELECT COUNT(*) FROM [master].[INFORMATION_SCHEMA].[TABLES] WHERE TABLE_SCHEMA = 'guest' AND TABLE_NAME = 'ExchangeGlobalSettings') IF (@exchangeTableCount > 0) BEGIN SET @allowUnsafeAssemblies = (SELECT COUNT(*) FROM [master].[guest].[ExchangeGlobalSettings] WHERE SettingName = 'AllowUnsafeAssemblies' AND IsEnabled = 1) END IF (@allowUnsafeAssemblies = 0) BEGIN CREATE ASSEMBLY ExchangeUDFs FROM '{4}\\ExchangeUDFs.dll' END ELSE BEGIN ALTER DATABASE [{0}] SET TRUSTWORTHY ON CREATE ASSEMBLY ExchangeUDFs FROM '{4}\\ExchangeUDFs.dll' WITH PERMISSION_SET = UNSAFE END ALTER ASSEMBLY ExchangeUDFs ADD FILE FROM '{4}\\ExchangeUdfCommon.dll' ",
			"create function [Exchange].[AttachmentTableFunction] (@blob varbinary(max)) returns table (attachmentNumber int, inid bigint) as external name [ExchangeUDFs].[ExchangeUDFClass].[AttachmentTableFunction] ",
			"create function [Exchange].[ConversationMembersBlob] (@blob varbinary(max)) returns table ( folderId binary(26), messageId binary(26), sortPosition int) as external name [ExchangeUDFs].[ExchangeUDFClass].[ConversationMembersTableFunction] ",
			"CREATE FUNCTION [Exchange].[getPropTagList] (@propBlob varbinary(max)) RETURNS TABLE ( propTag bigint, propId smallint, propType nvarchar(20), propSize bigint, propValue nvarchar(max)) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[GetPropTagList] ",
			"CREATE FUNCTION [Exchange].[getPhysicalIndexColumns] (@indexNumber int) RETURNS TABLE ( ColumnNumber int, KeyColumn bit, ColumnType nvarchar(20), MaxLength int, FixedLength bit, Ascending bit) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeLazyIndexingUDFClass].[GetPhysicalIndexColumns] ",
			"CREATE FUNCTION [Exchange].[FolderHierarchyBlob] (@folderHierarchyBlob varbinary(max)) RETURNS TABLE ( MailboxPartitionNumber int, MailboxNumber int, ParentFolderId binary(26), FolderId binary(26), DisplayName nvarchar(512), Depth int, SortPosition int) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[GetFolderHierarchy] ",
			"CREATE FUNCTION [Exchange].[getLogicalIndexColumns] (@indexNumber int) RETURNS TABLE ( ColumnNumber int, KeyColumn bit, ColumnName nvarchar(128), PropId bigint, FixedLength bit, MaxLength int, ColumnType nvarchar(128), ConditionalIndexName nvarchar(128), ConditionalIndexValue bit) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeLazyIndexingUDFClass].[GetLogicalIndexColumns] ",
			"CREATE FUNCTION [Exchange].[Catalog] (@tableNameBlob varbinary(max)) RETURNS TABLE ( TableName nvarchar(128), TableType nvarchar(32), PartitionKey nvarchar(64), ParameterTypes nvarchar(128), Visibility nvarchar(32)) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[GetCatalog] ",
			"CREATE FUNCTION [Exchange].[promoteProperties] (@propBlob varbinary(max), @offPageBlob varbinary(max), @promotedPropList varbinary(max)) RETURNS varbinary(max) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[PromoteProperties] ",
			"CREATE FUNCTION [Exchange].[IndexExplosionTableFunction] (@explosionColumnBlob varbinary(max)) RETURNS TABLE ( InstanceNum int) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[IndexExplosionTableFunction] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_smallint] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS smallint AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertySmallInt] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_int] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS int AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyInt] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_bigint] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS bigint AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyBigInt] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_datetime] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS datetime AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyDateTime] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_nvarchar] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS nvarchar(max) AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyNVarChar] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_UNIQUEIDENTIFIER] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS UNIQUEIDENTIFIER AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyUniqueIdentifier] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_binary] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS binary AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyBinary] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_single] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS real AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyReal] ",
			"CREATE FUNCTION [Exchange].[multiValueInstanceProperty_double] (@instanceNumber int, @multiValuesBlob varbinary(max)) RETURNS float AS EXTERNAL NAME [ExchangeUDFs].[ExchangeUDFClass].[MultiValueInstancePropertyFloat] ",
			"CREATE TYPE [Exchange].[MessagePropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.MessagePropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructMessagePropBag](@MailboxPartitionNumber INT,@MessageDocumentId INT) RETURNS [Exchange].[MessagePropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.MessagePropBagUdt].[Construct]; ",
			" CREATE TYPE [Exchange].[EmbeddedMessagePropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.EmbeddedMessagePropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructEmbeddedMessagePropBag](@MailboxPartitionNumber INT,@Inid BIGINT) RETURNS [Exchange].[EmbeddedMessagePropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.EmbeddedMessagePropBagUdt].[Construct]; ",
			" CREATE TYPE [Exchange].[FolderPropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.FolderPropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructFolderPropBag](@MailboxPartitionNumber INT,@FolderId BINARY(26)) RETURNS [Exchange].[FolderPropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.FolderPropBagUdt].[Construct]; ",
			" CREATE TYPE [Exchange].[AttachmentPropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.AttachmentPropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructAttachmentPropBag](@MailboxPartitionNumber INT,@Inid BIGINT) RETURNS [Exchange].[AttachmentPropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.AttachmentPropBagUdt].[Construct]; ",
			" CREATE TYPE [Exchange].[MailboxPropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.MailboxPropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructMailboxPropBag](@MailboxNumber INT) RETURNS [Exchange].[MailboxPropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.MailboxPropBagUdt].[Construct]; ",
			" CREATE TYPE [Exchange].[ConversationPropBagUdt] EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversationPropBagUdt]; ",
			"CREATE FUNCTION [Exchange].[ConstructConversationPropBag](@MailboxPartitionNumber INT,@MessageDocumentId INT) RETURNS [Exchange].[ConversationPropBagUdt] AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversationPropBagUdt].[Construct]; ",
			" CREATE FUNCTION [Exchange].[ConvertExchangeIdToInt64](@argument BINARY(26)) RETURNS BIGINT AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertExchangeIdToInt64] ",
			"CREATE FUNCTION [Exchange].[ConvertExchangeIdTo22ByteForm](@argument BINARY(26)) RETURNS BINARY(22) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertExchangeIdTo22ByteForm] ",
			"CREATE FUNCTION [Exchange].[ConvertExchangeIdTo24ByteForm](@argument BINARY(26)) RETURNS BINARY(24) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertExchangeIdTo24ByteForm] ",
			"CREATE FUNCTION [Exchange].[ConvertInt64ToFolderSvrEid](@argument BIGINT) RETURNS BINARY(21) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertInt64ToFolderSvrEid] ",
			"CREATE FUNCTION [Exchange].[ConvertExchangeIdToFolderSvrEid](@argument BINARY(26)) RETURNS BINARY(21) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertExchangeIdToFolderSvrEid] ",
			"CREATE FUNCTION [Exchange].[ConvertInt64To9ByteForm](@argument BIGINT) RETURNS BINARY(9) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertInt64To9ByteForm] ",
			"CREATE FUNCTION [Exchange].[TruncateBinary](@argument VARBINARY(MAX)) RETURNS VARBINARY(255) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[TruncateBinaryToFitInIndex] ",
			"CREATE FUNCTION [Exchange].[TruncateString](@argument NVARCHAR(MAX)) RETURNS NVARCHAR(127) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[TruncateStringToFitInIndex] ",
			"CREATE FUNCTION [Exchange].[ConvertInt64ToInt32](@argument BIGINT) RETURNS INT AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertInt64ToInt32] ",
			"CREATE FUNCTION [Exchange].[ConvertInt64ToBooleanNotZero](@argument BIGINT) RETURNS BIT AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertInt64ToBooleanNotZero] ",
			"CREATE FUNCTION [Exchange].[ConvertInt32ToBooleanNotZero](@argument INT) RETURNS BIT AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertInt32ToBooleanNotZero] ",
			"CREATE FUNCTION [Exchange].[ConvertGuidToBinary](@argument UNIQUEIDENTIFIER) RETURNS BINARY(16) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertGuidToBinary] ",
			"CREATE FUNCTION [Exchange].[ConvertLXCNArrayToLTIDArray](@argument VARBINARY(MAX)) RETURNS VARBINARY(MAX) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.ConversionUdfs].[ConvertLXCNArrayToLTIDArray] ",
			"CREATE FUNCTION [Exchange].[ComputeMailboxNumber](@mailboxPartitionNumber INT, @mailboxNumber INT) RETURNS INT AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.FunctionUdfs].[ComputeMailboxNumber] ",
			"CREATE FUNCTION [Exchange].[ComputeMessageInstanceKey](@fid BIGINT, @mid BIGINT, @instanceNum INT) RETURNS BINARY(21) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.FunctionUdfs].[ComputeMessageInstanceKey] ",
			"CREATE FUNCTION [Exchange].[ComputeMessageEntryId](@fid BIGINT, @mid BIGINT) RETURNS BINARY(21) AS EXTERNAL NAME [ExchangeUDFs].[Microsoft.Exchange.Server.Storage.LogicalDataModel.FunctionUdfs].[ComputeMessageEntryId] ",
			"CREATE TABLE [Exchange].[PseudoIndexControl] ( MailboxPartitionNumber INT NOT NULL, FolderId BINARY(26) NOT NULL, LogicalIndexNumber INT NOT NULL IDENTITY, IndexType INT NOT NULL, PhysicalIndexNumber INT NOT NULL, FirstUpdateRecord BIGINT NOT NULL, LastReferenceDate DATETIME2 NOT NULL, ColumnMappings VARBINARY(MAX) NOT NULL, ConditionalIndex VARBINARY(MAX) NULL, TableName NVARCHAR(256) COLLATE Latin1_General_BIN NOT NULL, CategorizationInfo VARBINARY(256) NULL, LogicalIndexVersion INT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL, IndexSignature INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsPseudoIndexControl] ON [Exchange].[PseudoIndexControl] ( ColumnMappings, ConditionalIndex, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[PseudoIndexControl] ADD CONSTRAINT [PseudoIndexControlPK] PRIMARY KEY ( MailboxPartitionNumber, FolderId, LogicalIndexNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[PseudoIndexControl] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[PseudoIndexDefinition] ( PhysicalIndexNumber INT NOT NULL IDENTITY, ColumnBlob VARBINARY(MAX) NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsPseudoIndexDefinition] ON [Exchange].[PseudoIndexDefinition] ( ColumnBlob, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[PseudoIndexDefinition] ADD CONSTRAINT [PseudoIndexDefinitionPK] PRIMARY KEY ( PhysicalIndexNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[PseudoIndexDefinition] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[PseudoIndexMaintenance] ( MailboxPartitionNumber INT NOT NULL, UpdateRecordNumber BIGINT NOT NULL IDENTITY, LogicalIndexNumber INT NOT NULL, LogicalOperation SMALLINT NOT NULL, UpdatedPropertiesBlob VARBINARY(MAX) NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsPseudoIndexMaintenance] ON [Exchange].[PseudoIndexMaintenance] ( UpdatedPropertiesBlob, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[PseudoIndexMaintenance] ADD CONSTRAINT [PseudoIndexMaintenancePK] PRIMARY KEY ( MailboxPartitionNumber, UpdateRecordNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[PseudoIndexMaintenance] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[DeliveredTo] ( MailboxNumber INT NOT NULL, SubmitTime DATETIME2 NOT NULL, MessageIdHash BIGINT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsDeliveredTo] ON [Exchange].[DeliveredTo] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[DeliveredTo] ADD CONSTRAINT [DeliveredToPK] PRIMARY KEY ( SubmitTime, MailboxNumber, MessageIdHash ) ",
			"ALTER INDEX ALL ON [Exchange].[DeliveredTo] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Events] ( EventCounter BIGINT NOT NULL IDENTITY, CreateTime DATETIME2 NOT NULL, TransactionId INT NOT NULL, EventType INT NOT NULL, MailboxNumber INT NOT NULL, ClientType INT NOT NULL, Flags INT NOT NULL, ObjectClass NVARCHAR(59) COLLATE Latin1_General_BIN NULL, Fid BINARY(24) NULL, Mid BINARY(24) NULL, OldFid BINARY(24) NULL, OldMid BINARY(24) NULL, OldParentFid BINARY(24) NULL, ItemCount INT NULL, UnreadCount INT NULL, Sid VARBINARY(68) NULL, DocumentId INT NULL, ExtendedFlags BIGINT NULL, ParentFid BINARY(24) NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = PAGE) ",
			"CREATE STATISTICS [StatsEvents] ON [Exchange].[Events] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Events] ADD CONSTRAINT [EventsPK] PRIMARY KEY ( EventCounter ) ",
			"ALTER INDEX ALL ON [Exchange].[Events] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Attachment] ( MailboxPartitionNumber INT NOT NULL, Inid BIGINT NOT NULL IDENTITY, AttachmentId BINARY(26) NULL, AttachmentMethod INT NULL, RenderingPosition INT NULL, CreationTime DATETIME2 NOT NULL, LastModificationTime DATETIME2 NOT NULL, Size BIGINT NOT NULL, Name NVARCHAR(512) COLLATE Latin1_General_BIN NULL, ContentId NVARCHAR(128) COLLATE Latin1_General_BIN NULL, ContentType NVARCHAR(128) COLLATE Latin1_General_BIN NULL, Content VARBINARY(MAX) NULL, MessageFlagsActual INT NULL, MailFlags SMALLINT NOT NULL, RecipientList VARBINARY(MAX) NULL, SubobjectsBlob VARBINARY(MAX) NULL, PropertyBlob VARBINARY(MAX) NULL, LargePropertyValueBlob VARBINARY(MAX) NULL, IsEmbeddedMessage BIT NULL, ExtensionBlob VARBINARY(MAX) NULL, FullTextType SMALLINT NULL, Language NVARCHAR(4) COLLATE Latin1_General_BIN NULL, PropertyBag AS [Exchange].[ConstructAttachmentPropBag](MailboxPartitionNumber, Inid), MailboxNumber INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsAttachment] ON [Exchange].[Attachment] ( Content, SubobjectsBlob, PropertyBlob, LargePropertyValueBlob, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Attachment] ADD CONSTRAINT [AttachmentPK] PRIMARY KEY ( MailboxPartitionNumber, Inid ) ",
			"ALTER INDEX ALL ON [Exchange].[Attachment] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Folder] ( MailboxPartitionNumber INT NOT NULL, FolderId BINARY(26) NOT NULL, LcnCurrent BINARY(26) NOT NULL, VersionHistory VARBINARY(MAX) NOT NULL, ParentFolderId BINARY(26) NULL, CreationTime DATETIME2 NOT NULL, CreatorSid VARBINARY(512) NOT NULL, LastModificationTime DATETIME2 NOT NULL, SourceKey VARBINARY(256) NULL, ChangeKey VARBINARY(256) NULL, LocalCommitTimeMax DATETIME2 NOT NULL, LastModifierSid VARBINARY(512) NOT NULL, DisplayName NVARCHAR(512) COLLATE Latin1_General_BIN NULL, Comment NVARCHAR(512) COLLATE Latin1_General_BIN NULL, ContainerClass NVARCHAR(128) COLLATE Latin1_General_BIN NULL, MessageCount BIGINT NOT NULL, TotalDeletedCount BIGINT NOT NULL, UnreadMessageCount BIGINT NOT NULL, VirtualUnreadMessageCount AS UnreadMessageCount, MessageSize BIGINT NOT NULL, MessageAttachCount BIGINT NOT NULL, MessageHasAttachCount BIGINT NOT NULL, HiddenItemCount BIGINT NOT NULL, UnreadHiddenItemCount BIGINT NOT NULL, HiddenItemSize BIGINT NOT NULL, HiddenItemHasAttachCount BIGINT NOT NULL, HiddenItemAttachCount BIGINT NOT NULL, DisplayType INT NULL, ConversationCount BIGINT NOT NULL, FolderCount BIGINT NOT NULL, SpecialFolderNumber SMALLINT NOT NULL, ReservedMessageIdGlobCntCurrent BIGINT NOT NULL, ReservedMessageIdGlobCntMax BIGINT NOT NULL, ReservedMessageCnGlobCntCurrent BIGINT NOT NULL, ReservedMessageCnGlobCntMax BIGINT NOT NULL, NextArticleNumber INT NOT NULL, MidsetDeleted VARBINARY(MAX) NULL, NormalItemPromotedColumns VARBINARY(MAX) NULL, HiddenItemPromotedColumns VARBINARY(MAX) NULL, PromotionTimestamp DATETIME2 NULL, PromotionUseHistory VARBINARY(MAX) NULL, QueryCriteria VARBINARY(MAX) NULL, SearchState INT NULL, SetSearchCriteriaFlags INT NULL, ScopeFolders VARBINARY(MAX) NULL, NonRecursiveSearchBacklinks VARBINARY(MAX) NULL, RecursiveSearchBacklinks VARBINARY(MAX) NULL, LogicalIndexNumber INT NULL, PropertyBlob VARBINARY(MAX) NULL, LargePropertyValueBlob VARBINARY(MAX) NULL, ExtensionBlob VARBINARY(MAX) NULL, PropertyBag AS [Exchange].[ConstructFolderPropBag](MailboxPartitionNumber, FolderId), AclTableAndSecurityDescriptor VARBINARY(MAX) NOT NULL, MidsetDeletedDelta VARBINARY(512) NULL, ReservedDocumentIdCurrent INT NULL, ReservedDocumentIdMax INT NULL, MailboxNumber INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsFolder] ON [Exchange].[Folder] ( MidsetDeleted, NormalItemPromotedColumns, HiddenItemPromotedColumns, PromotionUseHistory, QueryCriteria, ScopeFolders, NonRecursiveSearchBacklinks, RecursiveSearchBacklinks, PropertyBlob, LargePropertyValueBlob, ExtensionBlob, AclTableAndSecurityDescriptor ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Folder] ADD CONSTRAINT [FolderPK] PRIMARY KEY ( MailboxPartitionNumber, FolderId ) ",
			" CREATE UNIQUE INDEX [FolderChangeNumber] ON [Exchange].[Folder] ( MailboxPartitionNumber, LcnCurrent, FolderId ) ",
			" CREATE UNIQUE INDEX [FolderByParent] ON [Exchange].[Folder] ( MailboxPartitionNumber, ParentFolderId, FolderId ) ",
			"ALTER INDEX ALL ON [Exchange].[Folder] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[InferenceLog] ( MailboxPartitionNumber INT NOT NULL, RowId INT NOT NULL IDENTITY, CreateTime DATETIME2 NOT NULL, PropertyBlob VARBINARY(MAX) NULL, MailboxNumber INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"ALTER TABLE [Exchange].[InferenceLog] ADD CONSTRAINT [InferenceLogPK] PRIMARY KEY ( MailboxPartitionNumber, RowId ) ",
			"ALTER INDEX ALL ON [Exchange].[InferenceLog] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Message] ( MailboxPartitionNumber INT NOT NULL, MessageDocumentId INT NOT NULL, MessageId BINARY(26) NULL, FolderId BINARY(26) NULL, LcnCurrent BINARY(26) NOT NULL, VersionHistory VARBINARY(MAX) NOT NULL, GroupCns VARBINARY(MAX) NULL, LastModificationTime DATETIME2 NOT NULL, LcnReadUnread BINARY(26) NULL, SourceKey VARBINARY(256) NULL, ChangeKey VARBINARY(256) NULL, Size BIGINT NOT NULL, RecipientList VARBINARY(MAX) NULL, PropertyBlob VARBINARY(MAX) NULL, OffPagePropertyBlob VARBINARY(MAX) NULL, LargePropertyValueBlob VARBINARY(MAX) NULL, SubobjectsBlob VARBINARY(MAX) NULL, IsHidden BIT NOT NULL, IsRead BIT NOT NULL, VirtualIsRead AS IsRead, VirtualUnreadMessageCount AS Size, HasAttachments BIT NOT NULL, ConversationIndexTracking BIT NULL, MessageFlagsActual INT NOT NULL, MailFlags SMALLINT NOT NULL, Status INT NOT NULL, MessageClass NVARCHAR(255) COLLATE Latin1_General_BIN NULL, Importance INT NOT NULL, Sensitivity INT NOT NULL, Priority INT NOT NULL, ConversationIndex VARBINARY(MAX) NULL, ConversationMembers VARBINARY(MAX) NULL, SubjectPrefix NVARCHAR(1024) COLLATE Latin1_General_BIN NULL, ArticleNumber INT NULL, IMAPId INT NULL, DisplayTo NVARCHAR(MAX) COLLATE Latin1_General_BIN NULL, ConversationDocumentId INT NULL, BodyType SMALLINT NULL, DateCreated DATETIME2 NULL, CodePage INT NULL, DateReceived DATETIME2 NULL, DateSent DATETIME2 NULL, NativeBody VARBINARY(MAX) NULL, AnnotationToken VARBINARY(MAX) NULL, UserConfigurationXmlStream VARBINARY(MAX) NULL, UserConfigurationStream VARBINARY(MAX) NULL, ExtensionBlob VARBINARY(MAX) NULL, PropertyBag AS [Exchange].[ConstructMessagePropBag](MailboxPartitionNumber, MessageDocumentId), ConversationId BINARY(16) NULL, VirtualParentDisplay AS '', MailboxNumber INT NULL ) WITH (DATA_COMPRESSION = PAGE) ",
			"CREATE STATISTICS [StatsMessage] ON [Exchange].[Message] ( GroupCns, PropertyBlob, OffPagePropertyBlob, LargePropertyValueBlob, SubobjectsBlob, ConversationMembers, NativeBody, AnnotationToken, UserConfigurationXmlStream, UserConfigurationStream, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Message] ADD CONSTRAINT [MessagePK] PRIMARY KEY ( MailboxPartitionNumber, MessageDocumentId ) ",
			" CREATE UNIQUE INDEX [MessageUnique] ON [Exchange].[Message] ( MailboxPartitionNumber, FolderId, IsHidden, MessageId ) ",
			" CREATE UNIQUE INDEX [MessageIdUnique] ON [Exchange].[Message] ( MailboxPartitionNumber, MessageId ) ",
			" CREATE UNIQUE INDEX [ConversationIdUnique] ON [Exchange].[Message] ( MailboxPartitionNumber, ConversationId ) WHERE ConversationId IS NOT NULL ",
			" CREATE UNIQUE INDEX [IMAPIDUnique] ON [Exchange].[Message] ( MailboxPartitionNumber, FolderId, IMAPId ) WHERE FolderId IS NOT NULL AND IMAPId IS NOT NULL ",
			" CREATE UNIQUE INDEX [ArticleNumberUnique] ON [Exchange].[Message] ( MailboxPartitionNumber, FolderId, ArticleNumber ) WHERE FolderId IS NOT NULL AND ArticleNumber IS NOT NULL ",
			"ALTER INDEX ALL ON [Exchange].[Message] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[PerUser] ( MailboxPartitionNumber INT NOT NULL, ResidentFolder BIT NOT NULL, Guid UNIQUEIDENTIFIER NOT NULL, FolderId VARBINARY(26) NOT NULL, CnsetRead VARBINARY(MAX) NOT NULL, LastModificationTime DATETIME2 NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsPerUser] ON [Exchange].[PerUser] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[PerUser] ADD CONSTRAINT [PerUserPK] PRIMARY KEY ( MailboxPartitionNumber, ResidentFolder, FolderId, Guid ) ",
			"ALTER INDEX ALL ON [Exchange].[PerUser] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[ReceiveFolder] ( MailboxNumber INT NOT NULL, MessageClass NVARCHAR(128) COLLATE Latin1_General_BIN NOT NULL, FolderId BINARY(26) NOT NULL, LastModificationTime DATETIME2 NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsReceiveFolder] ON [Exchange].[ReceiveFolder] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[ReceiveFolder] ADD CONSTRAINT [ReceiveFolderPK] PRIMARY KEY ( MailboxNumber, MessageClass ) ",
			"ALTER INDEX ALL ON [Exchange].[ReceiveFolder] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[ReceiveFolder2] ( MailboxNumber INT NOT NULL, MessageClass VARBINARY(255) NOT NULL, FolderId BINARY(26) NOT NULL, LastModificationTime DATETIME2 NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsReceiveFolder2] ON [Exchange].[ReceiveFolder2] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[ReceiveFolder2] ADD CONSTRAINT [ReceiveFolder2PK] PRIMARY KEY ( MailboxNumber, MessageClass ) ",
			"ALTER INDEX ALL ON [Exchange].[ReceiveFolder2] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[SearchQueue] ( MailboxNumber INT NOT NULL, SearchFolderId BINARY(26) NOT NULL, UserSid BINARY(512) NOT NULL, ClientType INT NOT NULL, LCID INT NOT NULL, IncrementalScopeFolderId BINARY(26) NULL, CreationTime DATETIME2 NOT NULL, PopulationAttempts INT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsSearchQueue] ON [Exchange].[SearchQueue] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[SearchQueue] ADD CONSTRAINT [SearchQueuePK] PRIMARY KEY ( MailboxNumber, SearchFolderId ) ",
			"ALTER INDEX ALL ON [Exchange].[SearchQueue] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Tombstone] ( MailboxNumber INT NOT NULL, Inid BIGINT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL, SizeEstimate BIGINT NULL, ClientType INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsTombstone] ON [Exchange].[Tombstone] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Tombstone] ADD CONSTRAINT [TombstonePK] PRIMARY KEY ( MailboxNumber, Inid ) ",
			"ALTER INDEX ALL ON [Exchange].[Tombstone] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Watermarks] ( ConsumerGuid UNIQUEIDENTIFIER NOT NULL, MailboxNumber INT NOT NULL, EventCounter BIGINT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsWatermarks] ON [Exchange].[Watermarks] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Watermarks] ADD CONSTRAINT [WatermarksPK] PRIMARY KEY ( ConsumerGuid, MailboxNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[Watermarks] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[ExtendedPropertyNameMapping] ( MailboxPartitionNumber INT NOT NULL, PropNumber INT NOT NULL, PropGuid UNIQUEIDENTIFIER NOT NULL, PropName NVARCHAR(256) COLLATE Latin1_General_BIN NULL, PropDispId INT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsExtendedPropertyNameMapping] ON [Exchange].[ExtendedPropertyNameMapping] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[ExtendedPropertyNameMapping] ADD CONSTRAINT [ExtendedPropertyNameMappingPK] PRIMARY KEY ( MailboxPartitionNumber, PropNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[ExtendedPropertyNameMapping] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Globals] ( VersionName NVARCHAR(64) COLLATE Latin1_General_BIN NOT NULL, DatabaseVersion INT NOT NULL, Inid BIGINT NOT NULL, LastMaintenanceTask INT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL, EventCounterLowerBound BIGINT NULL, EventCounterUpperBound BIGINT NULL, DatabaseDsGuid UNIQUEIDENTIFIER NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsGlobals] ON [Exchange].[Globals] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Globals] ADD CONSTRAINT [GlobalsPK] PRIMARY KEY ( VersionName ) ",
			" CREATE UNIQUE INDEX [NewGlobalsPK] ON [Exchange].[Globals] ( DatabaseVersion ) ",
			"ALTER INDEX ALL ON [Exchange].[Globals] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[MailboxIdentity] ( MailboxPartitionNumber INT NOT NULL, LocalIdGuid UNIQUEIDENTIFIER NOT NULL, IdCounter BIGINT NOT NULL, CnCounter BIGINT NOT NULL, LastCounterPatchingTime DATETIME2 NOT NULL, ExtensionBlob VARBINARY(MAX) NULL, NextMessageDocumentId INT NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsMailboxIdentity] ON [Exchange].[MailboxIdentity] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[MailboxIdentity] ADD CONSTRAINT [MailboxIdentityPK] PRIMARY KEY ( MailboxPartitionNumber ) ",
			"ALTER INDEX ALL ON [Exchange].[MailboxIdentity] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[Mailbox] ( MailboxNumber INT NOT NULL, MailboxGuid UNIQUEIDENTIFIER NULL, OwnerADGuid UNIQUEIDENTIFIER NOT NULL, OwnerLegacyDN NVARCHAR(1024) COLLATE Latin1_General_BIN NOT NULL, MailboxInstanceGuid UNIQUEIDENTIFIER NULL, MappingSignatureGuid UNIQUEIDENTIFIER NOT NULL, MailboxOwnerDisplayName NVARCHAR(1024) COLLATE Latin1_General_BIN NULL, DisplayName NVARCHAR(1024) COLLATE Latin1_General_BIN NULL, SimpleDisplayName NVARCHAR(128) COLLATE Latin1_General_BIN NULL, Comment NVARCHAR(1024) COLLATE Latin1_General_BIN NULL, OofState BIT NOT NULL, DeletedOn DATETIME2 NULL, Status SMALLINT NOT NULL, Lcid INT NOT NULL, PropertyBlob VARBINARY(MAX) NULL, PropertyBag AS [Exchange].[ConstructMailboxPropBag](MailboxNumber), LargePropertyValueBlob VARBINARY(MAX) NULL, MessageCount BIGINT NOT NULL, MessageSize BIGINT NOT NULL, HiddenMessageCount BIGINT NOT NULL, HiddenMessageSize BIGINT NOT NULL, MessageDeletedCount BIGINT NOT NULL, MessageDeletedSize BIGINT NOT NULL, HiddenMessageDeletedCount BIGINT NOT NULL, HiddenMessageDeletedSize BIGINT NOT NULL, LastLogonTime DATETIME2 NULL, LastLogoffTime DATETIME2 NULL, ConversationEnabled BIT NOT NULL, MailboxDatabaseVersion INT NOT NULL, LastQuotaNotificationTime DATETIME2 NOT NULL, PreservingMailboxSignature BIT NOT NULL, TenantHint VARBINARY(128) NULL, NextMessageDocumentId INT NOT NULL, DefaultPromotedMessagePropertyIds VARBINARY(MAX) NULL, AlwaysPromotedMessagePropertyIds VARBINARY(MAX) NULL, ExtensionBlob VARBINARY(MAX) NULL, LastMailboxMaintenanceTime DATETIME2 NULL, MailboxPartitionNumber INT NULL, UnifiedMailboxGuid UNIQUEIDENTIFIER NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsMailbox] ON [Exchange].[Mailbox] ( PropertyBlob, LargePropertyValueBlob, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[Mailbox] ADD CONSTRAINT [Mailbox_UNIQUE] UNIQUE ( MailboxNumber ) WITH (DATA_COMPRESSION = ROW) ",
			"ALTER TABLE [Exchange].[Mailbox] ADD CONSTRAINT [MailboxTablePK] PRIMARY KEY ( MailboxNumber ) ",
			" CREATE UNIQUE INDEX [MailboxGuidIndex] ON [Exchange].[Mailbox] ( MailboxGuid ) WHERE MailboxGuid IS NOT NULL ",
			" CREATE INDEX [UnifiedMailboxGuidIndex] ON [Exchange].[Mailbox] ( UnifiedMailboxGuid ) WHERE UnifiedMailboxGuid IS NOT NULL ",
			"ALTER INDEX ALL ON [Exchange].[Mailbox] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[ReplidGuidMap] ( MailboxPartitionNumber INT NOT NULL, Guid UNIQUEIDENTIFIER NOT NULL, Replid SMALLINT NOT NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsReplidGuidMap] ON [Exchange].[ReplidGuidMap] ( ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[ReplidGuidMap] ADD CONSTRAINT [ReplidGuidMapPK] PRIMARY KEY ( MailboxPartitionNumber, Guid ) ",
			"ALTER INDEX ALL ON [Exchange].[ReplidGuidMap] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE TABLE [Exchange].[TimedEvents] ( EventTime DATETIME2 NOT NULL, UniqueId BIGINT NOT NULL IDENTITY, MailboxNumber INT NULL, EventSource UNIQUEIDENTIFIER NOT NULL, EventType INT NOT NULL, QoS INT NOT NULL, EventData VARBINARY(MAX) NULL, ExtensionBlob VARBINARY(MAX) NULL ) WITH (DATA_COMPRESSION = ROW) ",
			"CREATE STATISTICS [StatsTimedEvents] ON [Exchange].[TimedEvents] ( EventData, ExtensionBlob ) WITH NORECOMPUTE ",
			"ALTER TABLE [Exchange].[TimedEvents] ADD CONSTRAINT [TimedEventsPK] PRIMARY KEY ( EventTime, UniqueId ) ",
			"ALTER INDEX ALL ON [Exchange].[TimedEvents] SET (ALLOW_PAGE_LOCKS = OFF) ",
			"CREATE VIEW [Exchange].[PhysicalIndexes] AS SELECT pi.PhysicalIndexNumber, pic.ColumnNumber, pic.KeyColumn, pic.ColumnType, pic.MaxLength, pic.Ascending FROM [Exchange].[PseudoIndexDefinition] pi CROSS APPLY [Exchange].[getPhysicalIndexColumns](pi.PhysicalIndexNumber) pic; ",
			"CREATE VIEW [Exchange].[LogicalIndexes] AS SELECT li.LogicalIndexNumber, li.PhysicalIndexNumber, li.MailboxPartitionNumber, li.TableName, li.FolderId, li.FirstUpdateRecord, li.LastReferenceDate, lic.ColumnNumber, lic.KeyColumn, lic.ColumnName, lic.PropId, lic.FixedLength, lic.MaxLength, lic.ColumnType, pi.Ascending, lic.ConditionalIndexName, lic.ConditionalIndexValue FROM [Exchange].[PhysicalIndexes] pi, [Exchange].[PseudoIndexControl] li CROSS APPLY [Exchange].[getLogicalIndexColumns](li.LogicalIndexNumber) lic WHERE pi.PhysicalIndexNumber = li.PhysicalIndexNumber AND pi.ColumnNumber = lic.ColumnNumber ",
			"CREATE VIEW [Exchange].[IndexMaintenance] AS SELECT pim.UpdateRecordNumber, li.LogicalIndexNumber, CASE pim.LogicalOperation WHEN 1 THEN 'Insert' WHEN 2 THEN 'Update' WHEN 3 THEN 'Delete' END AS LogicalOperation, li.ColumnName, CAST(li.PropId AS BINARY(4)) as PropId, ptl.propSize, ptl.propValue FROM Exchange.LogicalIndexes li, Exchange.PseudoIndexMaintenance pim CROSS APPLY Exchange.getPropTagList(pim.UpdatedPropertiesBlob) ptl WHERE li.ColumnNumber = ptl.propTag/0x10000 AND li.LogicalIndexNumber = pim.LogicalIndexNumber AND pim.LogicalOperation <> 3 UNION SELECT pim.UpdateRecordNumber, pim.LogicalIndexNumber, CASE pim.LogicalOperation WHEN 1 THEN 'Insert' WHEN 2 THEN 'Update' WHEN 3 THEN 'Delete' END AS LogicalOperation, pk.COLUMN_NAME AS ColumnName, CAST(0 AS BINARY(4)) AS PropId, ptl.propSize, ptl.propValue FROM Exchange.PseudoIndexControl pic, INFORMATION_SCHEMA.KEY_COLUMN_USAGE pk, Exchange.PseudoIndexMaintenance pim CROSS APPLY Exchange.getPropTagList(pim.UpdatedPropertiesBlob) ptl WHERE pim.LogicalIndexNumber = pic.LogicalIndexNumber AND (pk.ORDINAL_POSITION-1) = ptl.propTag/0x10000 AND pim.LogicalOperation = 3 AND pk.TABLE_SCHEMA='Exchange' AND pk.TABLE_NAME = pic.TableName COLLATE Latin1_General_BIN AND pk.CONSTRAINT_NAME=pic.TableName+'_PK' COLLATE Latin1_General_BIN ",
			"CREATE PROC [Exchange].[sp_start_trace] AS BEGIN DECLARE @traceOn INT SELECT @traceOn = COUNT(*) FROM ::fn_trace_getinfo(default) WHERE property = 2 AND CAST(VALUE as NVARCHAR(255)) LIKE '%MailboxDiagnostics%' IF (@traceOn = 0) BEGIN DECLARE @rc INT DECLARE @traceid INT DECLARE @maxfilesize BIGINT SET @maxfilesize = 50 DECLARE @traceFileName NVARCHAR(255) DECLARE @iterator INT SET @iterator = 0 SET @rc = 12 DECLARE @date DATETIME SET @date = GETDATE(); WHILE (@rc = 12) BEGIN SET @traceFileName = N'{5}MailboxDiagnostics' + CAST(DATEPART(yyyy, @date) as NVARCHAR(50)) + CAST(DATEPART(mm, @date) as NVARCHAR(50)) + CAST(DATEPART(dd, @date) as NVARCHAR(50)) + N'I' + CAST(@iterator as NVARCHAR(50)) BEGIN TRY EXEC @rc=sp_trace_create @traceid=@traceid output, @options=2, @tracefile=@traceFileName, @maxfilesize=@maxfilesize, @stoptime=NULL END TRY BEGIN CATCH END CATCH SET @iterator = @iterator + 1 END DECLARE @on BIT SET @on = 1 EXEC sp_trace_setevent @TraceID,@eventid=148,@columnid=1,@on=@on EXEC sp_trace_setevent @TraceID,@eventid=148,@columnid=3,@on=@on EXEC sp_trace_setevent @TraceID,@eventid=148,@columnid=10,@on=@on EXEC sp_trace_setevent @TraceID,@eventid=148, @columnid=12,@on=@on EXEC sp_trace_setevent @TraceID,@eventid=148,@columnid=12,@on=@on EXEC sp_trace_setstatus @TraceID, 1 END END "
		};
	}
}
