Type.registerNamespace("AjaxControlToolkit");AjaxControlToolkit.ModalPopupBehavior=function(element){AjaxControlToolkit.ModalPopupBehavior.initializeBase(this,[element]);this._PopupControlID=null;this._BackgroundCssClass=null;this._xCoordinate=-1;this._yCoordinate=-1;this._backgroundElement=null;this._foregroundElement=null;this._popupElement=null;this._showHandler=null;this._scrollHandler=null;this._resizeHandler=null;this._windowHandlersAttached=false;this._saveTabIndexes=[];this._saveDesableSelect=[];this._saveDisabledControls=[];this._saveLinks=[];this._tagWithTabIndex=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME","DIV"];this._disableControlTag=["BUTTON","INPUT","SELECT","TEXTAREA"]};AjaxControlToolkit.ModalPopupBehavior.prototype={initialize:function(){AjaxControlToolkit.ModalPopupBehavior.callBaseMethod(this,"initialize");this._popupElement=$get(this._PopupControlID);this._foregroundElement=$get(this._PopupControlID);this._backgroundElement=document.createElement("div");this._backgroundElement.style.visibility="hidden";this._backgroundElement.style.display="none";this._backgroundElement.style.position="absolute";this._backgroundElement.style.left="0px";this._backgroundElement.style.top="0px";this._backgroundElement.style.zIndex=10000;if(this._BackgroundCssClass)this._backgroundElement.className=this._BackgroundCssClass;this._foregroundElement.parentNode.appendChild(this._backgroundElement);this._foregroundElement.style.display="none";this._foregroundElement.style.visibility="hidden";this._foregroundElement.style.position="absolute";this._foregroundElement.style.zIndex=CommonToolkitScripts.getCurrentStyle(this._backgroundElement,"zIndex",this._backgroundElement.style.zIndex)+1;this._showHandler=Function.createDelegate(this,this._onShow);$addHandler(this.get_element(),"click",this._showHandler);this._scrollHandler=Function.createDelegate(this,this._onLayout);this._resizeHandler=Function.createDelegate(this,this._onLayout)},dispose:function(){this._detachPopup();this._scrollHandler=null;this._resizeHandler=null;if(this._showHandler){$removeHandler(this.get_element(),"click",this._showHandler);this._showHandler=null}AjaxControlToolkit.ModalPopupBehavior.callBaseMethod(this,"dispose")},_attachPopup:function(){$addHandler(window,"resize",this._resizeHandler);$addHandler(window,"scroll",this._scrollHandler);this._windowHandlersAttached=true},_detachPopup:function(){if(this._windowHandlersAttached){if(this._scrollHandler)$removeHandler(window,"scroll",this._scrollHandler);if(this._resizeHandler)$removeHandler(window,"resize",this._resizeHandler);this._windowHandlersAttached=false}},_onShow:function(e){if(!this.get_element().disabled){this.show();e.preventDefault();return false}},_onLayout:function(){this._layout()},add_onShowing:function(value){this.get_events().addHandler("OnShowing",value)},remove_onShowing:function(value){this.get_events().removeHandler("OnShowing",value)},_raiseOnShowing:function(args){var handler=this.get_events().getHandler("OnShowing");if(null!==handler)handler(this,args)},show:function(){this._attachPopup();this._foregroundElement.style.zIndex=this._getNextZIndex();AjaxControlToolkit.ModalPopupBehavior.popupZIndexList.push(this._foregroundElement.style.zIndex);this._backgroundElement.style.display="";this._backgroundElement.style.visibility="visible";this._foregroundElement.style.display="";this._foregroundElement.style.visibility="visible";this._popupElement.style.display="";var args=new Sys.EventArgs;this._raiseOnShowing(args);this.disableTab();this._layout();this._layout()},_getNextZIndex:function(){if(AjaxControlToolkit.ModalPopupBehavior.popupZIndexList.length==0)return CommonToolkitScripts.getCurrentStyle(this._backgroundElement,"zIndex",this._backgroundElement.style.zIndex)+1;else return AjaxControlToolkit.ModalPopupBehavior.popupZIndexList[AjaxControlToolkit.ModalPopupBehavior.popupZIndexList.length-1]+1},disableTab:function(){var i=0,tagElements,tagElementsInPopUp=[];Array.clear(this._saveTabIndexes);Array.clear(this._saveDisabledControls);Array.clear(this._saveLinks);for(var j=0;j<this._tagWithTabIndex.length;j++){tagElements=this._foregroundElement.getElementsByTagName(this._tagWithTabIndex[j]);for(var k=0;k<tagElements.length;k++){tagElementsInPopUp[i]=tagElements[k];i++}}var documents=[];documents.push(document);for(var frameIndex=0;frameIndex<window.frames.length;frameIndex++)try{var doc=window.frames[frameIndex].document,body=doc.body;documents.push(doc)}catch(error){}i=0;var disabledControlIndex=0;for(var j=0;j<this._tagWithTabIndex.length;j++)for(var docIndex=0;docIndex<documents.length;docIndex++){tagElements=documents[docIndex].getElementsByTagName(this._tagWithTabIndex[j]);for(var k=0;k<tagElements.length;k++)if(Array.indexOf(tagElementsInPopUp,tagElements[k])==-1)if(Array.contains(this._disableControlTag,tagElements[k].tagName)){if((tagElements[k].getAttribute("disabled")==null||tagElements[k].getAttribute("disabled")==false)&&(typeof tagElements[k].disabled==="undefined"||tagElements[k].disabled==false)){this._saveDisabledControls[disabledControlIndex]=tagElements[k];tagElements[k].setAttribute("disabled",true);disabledControlIndex++}}else if(this.isControlToDisableTab(tagElements[k])){this._saveTabIndexes[i]={tag:tagElements[k],index:tagElements[k].tabIndex};tagElements[k].tabIndex="-1";i++}}i=0;for(var docIndex=0;docIndex<documents.length;docIndex++){tagElements=documents[docIndex].getElementsByTagName("a");for(var k=0;k<tagElements.length;k++)if(Array.indexOf(tagElementsInPopUp,tagElements[k])==-1){this._saveLinks[i]={tag:tagElements[k],href:tagElements[k].getAttribute("href"),onclick:tagElements[k].onclick,target:tagElements[k].getAttribute("target")};tagElements[k].removeAttribute("href");tagElements[k].onclick=null;tagElements[k].removeAttribute("target");i++}}},isControlToDisableTab:function(element){return element.tagName!="DIV"||element.getAttribute("tabIndex")!=null&&element.attributes["tabIndex"]!=null&&element.attributes["tabIndex"].specified},restoreTab:function(){for(var i=0;i<this._saveTabIndexes.length;i++)try{this._saveTabIndexes[i].tag.tabIndex=this._saveTabIndexes[i].index}catch(error){}for(var i=0;i<this._saveDisabledControls.length;i++)try{this._saveDisabledControls[i].removeAttribute("disabled")}catch(error){}for(var i=0;i<this._saveLinks.length;i++)try{if(this._saveLinks[i].href!=null&&this._saveLinks[i].href!="")this._saveLinks[i].tag.setAttribute("href",this._saveLinks[i].href);if(this._saveLinks[i].onclick!=null)this._saveLinks[i].tag.onclick=this._saveLinks[i].onclick;if(this._saveLinks[i].target!=null)this._saveLinks[i].tag.setAttribute("target",this._saveLinks[i].target)}catch(error){}Array.clear(this._saveTabIndexes);Array.clear(this._saveDisabledControls);Array.clear(this._saveLinks)},hide:function(skipHidingForeground,skipRestoreTab){this._backgroundElement.style.display="none";this._backgroundElement.style.visibility="hidden";if(!skipHidingForeground){this._foregroundElement.style.display="none";this._foregroundElement.style.visibility="hidden"}var index=Array.indexOf(AjaxControlToolkit.ModalPopupBehavior.popupZIndexList,CommonToolkitScripts.getCurrentStyle(this._foregroundElement,"zIndex",this._foregroundElement.style.zIndex));AjaxControlToolkit.ModalPopupBehavior.popupZIndexList.splice(index,1);if(!skipRestoreTab)this.restoreTab();this._detachPopup()},_layout:function(){var clientBounds=CommonToolkitScripts.getClientBounds(),clientWidth=clientBounds.width,clientHeight=clientBounds.height,limit=4096;this._backgroundElement.style.width=Math.min(limit,Math.max(Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),clientWidth))+"px";this._backgroundElement.style.height=Math.min(limit,Math.max(Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),clientHeight))+"px";if(this._xCoordinate<0)this._foregroundElement.style.left=(clientWidth-this._foregroundElement.offsetWidth)/2+"px";else{this._foregroundElement.style.position="fixed";this._foregroundElement.style.left=this._xCoordinate+"px"}if(this._yCoordinate<0)this._foregroundElement.style.top=(clientHeight-this._foregroundElement.offsetHeight)/2+"px";else{this._foregroundElement.style.position="fixed";this._foregroundElement.style.top=this._yCoordinate+"px"}},layoutModalPopup:function(){this._layout()},get_PopupControlID:function(){return this._PopupControlID},set_PopupControlID:function(value){if(this._PopupControlID!=value){this._PopupControlID=value;this.raisePropertyChanged("PopupControlID")}},get_X:function(){return this._xCoordinate},set_X:function(value){if(this._xCoordinate!=value){this._xCoordinate=value;this.raisePropertyChanged("X")}},get_Y:function(){return this._yCoordinate},set_Y:function(value){if(this._yCoordinate!=value){this._yCoordinate=value;this.raisePropertyChanged("Y")}},get_BackgroundCssClass:function(){return this._BackgroundCssClass},set_BackgroundCssClass:function(value){if(this._BackgroundCssClass!=value){this._BackgroundCssClass=value;this.raisePropertyChanged("BackgroundCssClass")}}};AjaxControlToolkit.ModalPopupBehavior.registerClass("AjaxControlToolkit.ModalPopupBehavior",Sys.UI.Behavior);AjaxControlToolkit.ModalPopupBehavior.invokeViaServer=function(behaviorID,show){var behavior=$find(behaviorID);if(behavior)if(show)behavior.show();else behavior.hide()};AjaxControlToolkit.ModalPopupBehavior.popupZIndexList=[];